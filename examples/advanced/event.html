<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BubbleChart â€“ Event Handling (Modern)</title>


    <!-- Dependencies -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="../../dist/bubble-chart.min.js"></script>
    <script src="../js/companies.js"></script>
    <script type="module">
        import { showClickNotification } from '../js/notification-utils.js';
        window.showClickNotification = showClickNotification;
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Map companies data to expected format
            const data = window.data.slice(0, 20).map(d => ({
                ...d,
                label: d.name,
                size: d.profits,
                count: Math.round((d.profits / Math.max(...window.data.map(x => x.profits))) * 100),
                category: d.sector  // Add sector for color categorization
            }));

            // ðŸš€ D3-Native: Chart renders automatically when data is bound!
            const chart = BubbleChart.create('#test')
                .withData(data)            // âœ¨ Auto-renders here!
                .withLabel('label')
                .withSize('size')
                .withColor('category')   // Color by sector
                .withAnimations('gentle') // âœ¨ Pure D3 staggered entrance animations!
                .build();                // Returns live chart (already rendered)

            // DOM event handlers using D3-native API
            chart.on('mouseenter', (d) => {
                console.log('Mouse entered:', d.label);
            });
            
            chart.on('mouseover', (d) => {
                console.log('Mouse over:', d.label);
            });
            
            chart.on('mouseout', (d) => {
                console.log('Mouse out:', d.label);
            });
            
            chart.on('click', (d) => {
                console.log('Bubble clicked:', d.label);
                const dataCopy = { ...d };
                delete dataCopy.parent;
                console.log(`Clicked: ${d.label}\nData:`, dataCopy);
                
                // Non-blocking notification instead of alert
                window.showClickNotification(d.label, dataCopy);
            });

            console.log('Chart created with D3-native event handling');
        });
    </script>
</head>

<body>
    <h1>BubbleChart â€“ Event Handling (Modern)</h1>
    <div id="test" style="width: 800px; height: 600px;"></div>
</body>
