<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BubbleChart – Event Handling (Modern)</title>


    <!-- Dependencies -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="../../dist/bubble-chart.min.js"></script>
    <script src="../js/companies.js"></script>
    <script type="module">
        import { showClickNotification } from '../js/notification-utils.js';
        window.showClickNotification = showClickNotification;
    </script>

    <style>
        body { font-family: system-ui, sans-serif; margin: 0; padding: 0; }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        #test { width: 100%; height: 600px; }
        /* Mobile optimizations */
        @media (max-width: 768px) {
            .container { padding: 0.5rem; }
            #test { height: 500px; }
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // D3-native Responsive Text Setup
            const ResponsiveTextUtils = BubbleChart.ResponsiveTextUtils;
            
            // Initialize responsive page layout
            ResponsiveTextUtils.createResponsivePage('.container');
            
            // Setup responsive typography
            ResponsiveTextUtils.setupResponsiveHeadings();
            
            // Map companies data to expected format
            const data = window.data.slice(0, 20).map(d => ({
                ...d,
                label: d.name,
                size: d.profits,
                count: Math.round((d.profits / Math.max(...window.data.map(x => x.profits))) * 100),
                category: d.sector  // Add sector for color categorization
            }));

            // 🚀 D3-Native: Chart renders automatically when data is bound!
            const chart = BubbleChart.create('#test')
                .withData(data)            // ✨ Auto-renders here!
                .withLabel('label')
                .withSize('size')
                .withColor('category')   // Color by sector
                .withAnimations('gentle') // ✨ Pure D3 staggered entrance animations!
                .withResponsive({
                    minWidth: 320,
                    minHeight: 350,
                    maxHeight: 600,
                    debounceMs: 200,
                    onResize: (dimensions) => {
                        console.log('📏 Event Handling chart resized to:', dimensions);
                    }
                })
                .build();                // Returns live chart (already rendered)

            // DOM event handlers using D3-native API
            chart.on('mouseenter', (d) => {
                console.log('Mouse entered:', d.label);
            });
            
            chart.on('mouseover', (d) => {
                console.log('Mouse over:', d.label);
            });
            
            chart.on('mouseout', (d) => {
                console.log('Mouse out:', d.label);
            });
            
            chart.on('click', (d) => {
                console.log('Bubble clicked:', d.label);
                const dataCopy = { ...d };
                delete dataCopy.parent;
                console.log(`Clicked: ${d.label}\nData:`, dataCopy);
                
                // Non-blocking notification instead of alert
                window.showClickNotification(d.label, dataCopy);
            });

            console.log('Chart created with D3-native event handling');
        });
    </script>
</head>

<body>
    <div class="container">
        <h1>BubbleChart – Event Handling (Modern)</h1>
        <div id="test"></div>
    </div>
</body>
