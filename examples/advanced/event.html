<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BubbleChart – Event Handling (Modern)</title>

    <!-- Styles -->
    <link rel="stylesheet" href="../../dist/css/bubble-chart.css" />

    <!-- Dependencies -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="../../dist/bubble-chart.min.js"></script>
    <script src="../js/companies.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Map companies data to expected format
            const data = window.data.slice(0, 20).map(d => ({
                ...d,
                label: d.name,
                size: d.profits,
                count: Math.round((d.profits / Math.max(...window.data.map(x => x.profits))) * 100),
                category: d.sector  // Add sector for color categorization
            }));

            const chart = BubbleChart.create('#test')
                .withData(data)
                .withLabel('label')
                .withSize('size')
                .withColor('category')  // Color by sector
                .withAnimations('gentle')
                .render();

            // DOM event handlers using onBubble method
            chart
                .onBubble('mouseenter', d => {
                    console.log('Mouse entered:', d.label);
                })
                .onBubble('mouseover', d => {
                    console.log('Mouse over:', d.label);
                })
                .onBubble('mouseout', d => {
                    console.log('Mouse out:', d.label);
                })
                .onBubble('click', d => {
                    console.log('Bubble clicked:', d.label);
                    const dataCopy = { ...d };
                    delete dataCopy.parent;
                    alert(`Clicked: ${d.label}\n\nData: ${JSON.stringify(dataCopy, null, 2)}`);
                });

            // Lifecycle events using regular on method
            chart.on('change', (stats) => {
                console.log('Data changed:', stats);
            });
        });
    </script>
</head>

<body>
    <h1>BubbleChart – Event Handling (Modern)</h1>
    <div id="test" style="width: 800px; height: 600px;"></div>
</body>
