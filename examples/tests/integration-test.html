<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integration Tests - Bubble Chart Library</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5rem;
            font-weight: 300;
        }

        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 40px;
            font-size: 1.1rem;
        }

        .test-section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }

        .test-section h2 {
            color: #2c3e50;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-section p {
            color: #34495e;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .chart-container {
            width: 100%;
            height: 400px;
            border: 2px dashed #bdc3c7;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            background: white;
            position: relative;
            overflow: hidden;
        }

        .placeholder {
            color: #95a5a6;
            font-size: 18px;
            text-align: center;
        }

        .log {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            line-height: 1.4;
        }

        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .success { background: #2ecc71; color: white; }
        .error { background: #e74c3c; color: white; }
        .warning { background: #f39c12; color: white; }
        .info { background: #3498db; color: white; }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #3498db;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .icon {
            font-size: 1.2rem;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Integration Tests</h1>
        <p class="subtitle">Comprehensive testing of BubbleBuilder functionality in real browser environment</p>

        <!-- Constructor & Configuration Tests -->
        <div class="test-section">
            <h2><span class="icon">üèóÔ∏è</span>Constructor & Configuration Tests</h2>
            <p>Test BubbleBuilder instantiation and configuration handling</p>
            <div class="controls">
                <button onclick="testConstructors()">Test Constructors</button>
                <button onclick="testConfigurations()">Test Configurations</button>
                <button onclick="clearChart('constructor-chart')">Clear</button>
            </div>
            <div id="constructor-chart" class="chart-container">
                <div class="placeholder">Click "Test Constructors" to run tests</div>
            </div>
            <div id="constructor-log" class="log"></div>
        </div>

        <!-- Data Processing Tests -->
        <div class="test-section">
            <h2><span class="icon">üìä</span>Data Processing Tests</h2>
            <p>Test data handling, processing, and validation</p>
            <div class="controls">
                <button onclick="testDataProcessing()">Test Data Processing</button>
                <button onclick="testDataValidation()">Test Data Validation</button>
                <button onclick="clearChart('data-chart')">Clear</button>
            </div>
            <div id="data-chart" class="chart-container">
                <div class="placeholder">Click "Test Data Processing" to run tests</div>
            </div>
            <div id="data-log" class="log"></div>
        </div>

        <!-- Rendering Tests -->
        <div class="test-section">
            <h2><span class="icon">üé®</span>Rendering Tests</h2>
            <p>Test SVG rendering, animations, and visual output</p>
            <div class="controls">
                <button onclick="testRendering()">Test Rendering</button>
                <button onclick="testAnimations()">Test Animations</button>
                <button onclick="clearChart('rendering-chart')">Clear</button>
            </div>
            <div id="rendering-chart" class="chart-container">
                <div class="placeholder">Click "Test Rendering" to run tests</div>
            </div>
            <div id="rendering-log" class="log"></div>
        </div>

        <!-- Performance Tests -->
        <div class="test-section">
            <h2><span class="icon">‚ö°</span>Performance Tests</h2>
            <p>Test performance with various data sizes and configurations</p>
            <div class="controls">
                <button onclick="testPerformance()">Test Performance</button>
                <button onclick="testLargeDataset()">Test Large Dataset</button>
                <button onclick="clearChart('performance-chart')">Clear</button>
            </div>
            <div id="performance-chart" class="chart-container">
                <div class="placeholder">Click "Test Performance" to run tests</div>
            </div>
            <div id="performance-log" class="log"></div>
        </div>

        <!-- API Tests -->
        <div class="test-section">
            <h2><span class="icon">üîß</span>API Tests</h2>
            <p>Test method chaining, event handling, and API compatibility</p>
            <div class="controls">
                <button onclick="testAPI()">Test API Methods</button>
                <button onclick="testEventHandling()">Test Events</button>
                <button onclick="clearChart('api-chart')">Clear</button>
            </div>
            <div id="api-chart" class="chart-container">
                <div class="placeholder">Click "Test API Methods" to run tests</div>
            </div>
            <div id="api-log" class="log"></div>
        </div>

        <!-- Summary Stats -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="total-tests">0</div>
                <div class="stat-label">Total Tests</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="passed-tests">0</div>
                <div class="stat-label">Passed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="failed-tests">0</div>
                <div class="stat-label">Failed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="pass-rate">0%</div>
                <div class="stat-label">Pass Rate</div>
            </div>
        </div>
    </div>

    <script type="module">
        // Import the bubble chart library
        import { BubbleBuilder, BubbleChart } from '/dist/bubble-chart.esm.js';
        
        // Make available globally for the test functions
        window.BubbleBuilder = BubbleBuilder;
        window.BubbleChart = BubbleChart;

        // Test state
        let totalTests = 0;
        let passedTests = 0;
        let failedTests = 0;

        // Update stats display
        function updateStats() {
            document.getElementById('total-tests').textContent = totalTests;
            document.getElementById('passed-tests').textContent = passedTests;
            document.getElementById('failed-tests').textContent = failedTests;
            const passRate = totalTests > 0 ? Math.round((passedTests / totalTests) * 100) : 0;
            document.getElementById('pass-rate').textContent = passRate + '%';
        }

        // Log function with status
        function log(containerId, message, status = 'info') {
            const logContainer = document.getElementById(containerId);
            const timestamp = new Date().toLocaleTimeString();
            const statusClass = status;
            const icon = status === 'error' ? '‚ùå' : status === 'success' ? '‚úÖ' : status === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            
            logContainer.innerHTML += `[${timestamp}] ${icon} ${message}\n`;
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // Test runner function
        function runTest(name, testFn, logContainer) {
            totalTests++;
            try {
                testFn();
                passedTests++;
                log(logContainer, `PASS: ${name}`, 'success');
                return true;
            } catch (error) {
                failedTests++;
                log(logContainer, `FAIL: ${name} - ${error.message}`, 'error');
                return false;
            } finally {
                updateStats();
            }
        }

        // Test data
        const testData = [
            { name: 'Technology', value: 1200, category: 'Sector', color: '#3498db' },
            { name: 'Healthcare', value: 800, category: 'Sector', color: '#2ecc71' },
            { name: 'Finance', value: 1500, category: 'Sector', color: '#e74c3c' },
            { name: 'Education', value: 600, category: 'Sector', color: '#f39c12' },
            { name: 'Retail', value: 900, category: 'Sector', color: '#9b59b6' }
        ];

        // Constructor Tests
        window.testConstructors = function() {
            log('constructor-log', 'Starting constructor tests...', 'info');
            
            const configs = [
                { container: '#constructor-chart', width: 400, height: 300 },
                { container: '#constructor-chart', width: 500, height: 400, bubble: { minRadius: 5 } },
                { container: '#constructor-chart', label: d => d.name, size: d => d.value }
            ];

            configs.forEach((config, index) => {
                runTest(`Constructor ${index + 1}`, () => {
                    const builder = new BubbleBuilder(config);
                    if (!builder) throw new Error('Builder not created');
                    if (typeof builder.data !== 'function') throw new Error('data method missing');
                    if (typeof builder.render !== 'function') throw new Error('render method missing');
                }, 'constructor-log');
            });
        };

        // Configuration Tests
        window.testConfigurations = function() {
            log('constructor-log', 'Starting configuration tests...', 'info');
            
            runTest('Configuration Access', () => {
                const builder = new BubbleBuilder({ container: '#constructor-chart' });
                const config = builder.options();
                if (!config) throw new Error('options returned null');
                if (config.container !== '#constructor-chart') throw new Error('Container not set correctly');
            }, 'constructor-log');

            runTest('Configuration Update', () => {
                const builder = new BubbleBuilder({ container: '#constructor-chart' });
                if (builder.updateOptions) {
                    const result = builder.updateOptions({ width: 800 });
                    if (result !== builder) throw new Error('updateOptions should return this');
                    const config = builder.options();
                    if (config.width !== 800) throw new Error('Configuration not updated');
                }
            }, 'constructor-log');
        };

        // Data Processing Tests
        window.testDataProcessing = function() {
            log('data-log', 'Starting data processing tests...', 'info');
            
            runTest('Data Method Chaining', () => {
                const builder = new BubbleBuilder({ container: '#data-chart' });
                const result = builder.data(testData);
                if (result !== builder) throw new Error('data() should return this');
            }, 'data-log');

            runTest('Data Storage', () => {
                const builder = new BubbleBuilder({ container: '#data-chart' });
                builder.data(testData);
                if (builder.chartData !== testData) throw new Error('Data not stored correctly');
                if (builder.chartData.length !== testData.length) throw new Error('Data length mismatch');
            }, 'data-log');

            runTest('Data Processing', () => {
                const builder = new BubbleBuilder({ container: '#data-chart' });
                builder.data(testData);
                if (builder.processedData && builder.processedData.length !== testData.length) {
                    throw new Error('Processed data length mismatch');
                }
            }, 'data-log');
        };

        // Data Validation Tests
        window.testDataValidation = function() {
            log('data-log', 'Starting data validation tests...', 'info');
            
            runTest('Empty Data Handling', () => {
                const builder = new BubbleBuilder({ container: '#data-chart' });
                const result = builder.data([]);
                if (result !== builder) throw new Error('Empty data should still return this');
                if (builder.chartData.length !== 0) throw new Error('Empty data not handled');
            }, 'data-log');

            runTest('Invalid Data Handling', () => {
                const builder = new BubbleBuilder({ container: '#data-chart' });
                // This should either handle gracefully or throw a meaningful error
                try {
                    builder.data(null);
                    // If no error, check if it was handled gracefully
                } catch (error) {
                    if (!error.message.includes('data')) throw new Error('Error message not helpful');
                }
            }, 'data-log');
        };

        // Rendering Tests
        window.testRendering = function() {
            log('rendering-log', 'Starting rendering tests...', 'info');
            clearChart('rendering-chart');
            
            runTest('Render Method Execution', () => {
                const builder = new BubbleBuilder({ container: '#rendering-chart' });
                builder.data(testData);
                const result = builder.render();
                if (result !== builder) throw new Error('render() should return this');
            }, 'rendering-log');

            runTest('SVG Creation', () => {
                const container = document.getElementById('rendering-chart');
                const svg = container.querySelector('svg');
                if (!svg) throw new Error('SVG element not created');
            }, 'rendering-log');

            runTest('Bubble Elements', () => {
                const container = document.getElementById('rendering-chart');
                const circles = container.querySelectorAll('circle');
                if (circles.length === 0) throw new Error('No bubble elements created');
            }, 'rendering-log');
        };

        // Animation Tests
        window.testAnimations = function() {
            log('rendering-log', 'Starting animation tests...', 'info');
            clearChart('rendering-chart');
            
            runTest('Animation Configuration', () => {
                const builder = new BubbleBuilder({ 
                    container: '#rendering-chart',
                    bubble: { animation: 1000 }
                });
                builder.data(testData).render();
                // If we get here without error, animation config worked
            }, 'rendering-log');
        };

        // Performance Tests
        window.testPerformance = function() {
            log('performance-log', 'Starting performance tests...', 'info');
            clearChart('performance-chart');
            
            const start = performance.now();
            const builder = new BubbleBuilder({ container: '#performance-chart' });
            builder.data(testData).render();
            const end = performance.now();
            
            const renderTime = end - start;
            log('performance-log', `Render time: ${renderTime.toFixed(2)}ms`, 'info');
            
            runTest('Performance Benchmark', () => {
                if (renderTime > 500) throw new Error(`Render too slow: ${renderTime}ms`);
            }, 'performance-log');
        };

        // Large Dataset Test
        window.testLargeDataset = function() {
            log('performance-log', 'Testing large dataset performance...', 'info');
            clearChart('performance-chart');
            
            // Generate large dataset
            const largeData = Array.from({ length: 100 }, (_, i) => ({
                name: `Item ${i + 1}`,
                value: Math.random() * 1000 + 100,
                category: `Category ${(i % 5) + 1}`,
                color: `hsl(${(i * 137.5) % 360}, 50%, 50%)`
            }));
            
            const start = performance.now();
            const builder = new BubbleBuilder({ container: '#performance-chart' });
            builder.data(largeData).render();
            const end = performance.now();
            
            const renderTime = end - start;
            log('performance-log', `Large dataset (${largeData.length} items): ${renderTime.toFixed(2)}ms`, 'info');
            
            runTest('Large Dataset Performance', () => {
                if (renderTime > 2000) throw new Error(`Large dataset too slow: ${renderTime}ms`);
            }, 'performance-log');
        };

        // API Tests
        window.testAPI = function() {
            log('api-log', 'Starting API tests...', 'info');
            
            runTest('Method Chaining', () => {
                const builder = new BubbleBuilder({ container: '#api-chart' });
                const result = builder.data(testData).render();
                if (result !== builder) throw new Error('Method chaining broken');
            }, 'api-log');

            runTest('Update Method', () => {
                const builder = new BubbleBuilder({ container: '#api-chart' });
                builder.data(testData).render();
                const result = builder.update();
                if (result !== builder) throw new Error('update() should return this');
            }, 'api-log');

            runTest('BubbleChart API', () => {
                const chart = new BubbleChart({ container: '#api-chart' });
                const result = chart.data(testData).render();
                if (result !== chart) throw new Error('BubbleChart chaining broken');
            }, 'api-log');
        };

        // Event Handling Tests
        window.testEventHandling = function() {
            log('api-log', 'Starting event handling tests...', 'info');
            
            runTest('Event Registration', () => {
                const builder = new BubbleBuilder({ container: '#api-chart' });
                if (builder.on) {
                    const result = builder.on('click', () => {});
                    if (result !== builder) throw new Error('on() should return this');
                }
            }, 'api-log');
        };

        // Utility function to clear charts
        window.clearChart = function(chartId) {
            const container = document.getElementById(chartId);
            container.innerHTML = '<div class="placeholder">Chart cleared</div>';
        };

        // Initialize stats
        updateStats();
    </script>
</body>
</html> 