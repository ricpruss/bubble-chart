<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Test: Simplified Orbit Builder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="./dist/bubble-chart.min.js"></script>
  <style>
    body { 
      font-family: sans-serif; 
      margin: 20px; 
      background: #f5f5f5; 
    }
    #chart-container {
      width: 100%;
      max-width: 800px;
      height: 600px;
      margin: auto;
      border: 1px solid #ddd;
      background: white;
      border-radius: 8px;
    }
    .info {
      max-width: 800px;
      margin: auto;
      padding: 20px;
      background: white;
      border-radius: 8px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="info">
    <h1>üåç Simplified Orbit Builder Test</h1>
    <p>Testing the new D3-native data processing approach:</p>
    <ul>
      <li>‚úÖ Simplified data handling using D3's native utilities</li>
      <li>‚úÖ Removed complex data lookup bug</li>
      <li>‚úÖ Direct use of D3's scales, accessors, and animations</li>
      <li>‚úÖ Reduced code complexity while maintaining functionality</li>
    </ul>
  </div>

  <div id="chart-container"></div>

  <script>
    // Test data using D3's native patterns - Enhanced for color testing
    const testData = [
      { label: "Mercury", size: 15, category: "inner", sector: "terrestrial" },
      { label: "Venus", size: 18, category: "inner", sector: "terrestrial" },
      { label: "Earth", size: 20, category: "inner", sector: "terrestrial" },
      { label: "Mars", size: 16, category: "inner", sector: "terrestrial" },
      { label: "Jupiter", size: 45, category: "outer", sector: "gas_giant" },
      { label: "Saturn", size: 40, category: "outer", sector: "gas_giant" },
      { label: "Uranus", size: 25, category: "outer", sector: "ice_giant" },
      { label: "Neptune", size: 24, category: "outer", sector: "ice_giant" },
      { label: "Pluto", size: 8, category: "dwarf", sector: "dwarf_planet" }
    ];

    console.log('Test data with categories:', testData);

    console.log('Creating orbit chart with simplified data handling...');

    try {
      // Test the simplified orbit builder
      const chart = BubbleChart.create("#chart-container")
        .withData(testData)
        .withLabel("label")
        .withSize("size")
        .withColor("category")
        .withType("orbit")
        .render();

      console.log('‚úÖ Orbit chart created successfully!');
      console.log('Chart instance:', chart);
      console.log('üé® Colors should be showing by category: inner, outer, dwarf');

      // Test that clicking shows category information
      setTimeout(() => {
        console.log('üìù Click on bubbles to see category information in console');
      }, 1000);

      // Test speed control
      setTimeout(() => {
        console.log('üöÄ Increasing orbit speed...');
        if (chart.setSpeedMultiplier) {
          chart.setSpeedMultiplier(1.5);
        }
      }, 3000);

      // Test different color accessor
      setTimeout(() => {
        console.log('üîÑ Switching to color by sector...');
        // Create new chart with sector coloring
        const chart2 = BubbleChart.create('#chart-container')
          .withData(testData)
          .withLabel('label')
          .withSize('size')
          .withColor('sector') // Now color by sector instead of category
          .withType('orbit')
          .render();
        
        console.log('üé® Colors should now show by sector: terrestrial, gas_giant, ice_giant, dwarf_planet');
      }, 8000);

      // Test data update using D3 patterns
      setTimeout(() => {
        console.log('üîÑ Testing data update...');
        const newData = [
          ...testData,
          { label: "Pluto", size: 8, category: "dwarf" }
        ];
        
        // This should work with the simplified approach
        if (chart.updateData) {
          chart.updateData(newData);
        } else {
          console.log('updateData method not available, using store...');
          if (chart.store && chart.store.replaceWith) {
            chart.store.replaceWith(newData);
          }
        }
      }, 6000);

    } catch (error) {
      console.error('‚ùå Error creating orbit chart:', error);
      document.getElementById('chart-container').innerHTML = 
        `<div style="padding: 20px; color: red;">
          <h3>Error:</h3>
          <pre>${error.message || error}</pre>
        </div>`;
    }

    // Monitor D3 usage
    console.log('D3 version:', d3.version);
    console.log('Available D3 modules:', Object.keys(d3).filter(k => typeof d3[k] === 'function').slice(0, 10));
  </script>
</body>
</html>
